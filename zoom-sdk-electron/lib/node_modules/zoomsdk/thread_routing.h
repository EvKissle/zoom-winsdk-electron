#ifndef _THREAD_ROUTING_H_
#define _THREAD_ROUTING_H_
#include <windows.h>
#include "thread_attach.h"

class CJSThreadMgr
{
public:
	~CJSThreadMgr();
	static CJSThreadMgr& GetInstance();

	bool Init();
	bool Uninit();

	bool PostTask2WorkThread(IJSCallTask* pTask);
	bool PostTaks2CallBackThread(IJSCallTask* pTask);
	bool PostTask2JSThread(IJSCallTask* pTask);

	void Callback2JSThreadProc();

private:
	CJSThreadMgr();
	void Reset();

	CThreadAttach m_workThreadAttach;
	CThreadAttach m_callbackThreadAttach;

	std::list<IJSCallTask*> m_callbackTaskList;
	CComAutoCriticalSection m_callbackTaskLock;
	HHOOK m_hMainThreadCallWndProc;
	bool m_bInit;
	DWORD m_dwMainThreadID;
	HANDLE m_hCallback2JSThread;
	bool m_bExit;
	HANDLE m_hWorkerEvent;
};
#endif